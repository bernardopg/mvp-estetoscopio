export const metadata = {
  title: "API Reference",
  description: "Documenta√ß√£o da API REST do MVP Estetosc√≥pio",
};

# üîå API Reference

<Callout type="info" title="API RESTful">
  Documenta√ß√£o completa das rotas de API dispon√≠veis no MVP Estetosc√≥pio.
</Callout>

---

## üîê Autentica√ß√£o

Todas as rotas protegidas requerem um token JWT v√°lido enviado via cookie `token`.

### Base URL

```
http://localhost:3000/api
```

---

## üìù Endpoints

### Autentica√ß√£o

<Card title="POST /api/auth/signup">

Cria uma nova conta de usu√°rio.

**Request Body**:

```json
{
  "name": "Jo√£o Silva",
  "email": "joao@example.com",
  "password": "senha123"
}
```

**Response** (201 Created):

```json
{
  "message": "Usu√°rio criado com sucesso",
  "user": {
    "id": 1,
    "name": "Jo√£o Silva",
    "email": "joao@example.com"
  }
}
```

**Errors**:

- `400`: Dados inv√°lidos ou incompletos
- `409`: Email j√° cadastrado
- `500`: Erro interno do servidor

</Card>

<Card title="POST /api/auth/login">

Realiza login e retorna token JWT em cookie.

**Request Body**:

```json
{
  "email": "joao@example.com",
  "password": "senha123"
}
```

**Response** (200 OK):

```json
{
  "message": "Login bem-sucedido",
  "user": {
    "id": 1,
    "name": "Jo√£o Silva",
    "email": "joao@example.com"
  }
}
```

**Errors**:

- `400`: Email ou senha ausentes
- `401`: Credenciais inv√°lidas
- `500`: Erro interno do servidor

</Card>

<Card title="POST /api/auth/logout">

Realiza logout removendo o cookie de autentica√ß√£o.

**Response** (200 OK):

```json
{
  "message": "Logout realizado"
}
```

**Errors**:

- `500`: Erro interno do servidor

</Card>

---

### Dashboard

<Card title="GET /api/dashboard">

üîí **Rota Protegida**

Retorna estat√≠sticas e informa√ß√µes do dashboard do usu√°rio.

**Response** (200 OK):

```json
{
  "user": {
    "id": 1,
    "name": "Jo√£o Silva",
    "email": "joao@example.com",
    "created_at": "2024-01-01T10:00:00Z"
  },
  "stats": {
    "totalDecks": 5,
    "totalCards": 120,
    "averageCardsPerDeck": 24,
    "largestDeckSize": 45
  },
  "recentDecks": [
    {
      "id": 1,
      "title": "Anatomia Card√≠aca",
      "cardCount": 25,
      "created_at": "2024-01-01T10:00:00Z",
      "updated_at": "2024-01-15T14:30:00Z"
    }
  ]
}
```

**Errors**:

- `401`: N√£o autenticado
- `500`: Erro interno do servidor

</Card>

---

### Baralhos (Decks)

<Card title="GET /api/decks">

üîí **Rota Protegida**

Lista todos os baralhos do usu√°rio autenticado.

**Response** (200 OK):

```json
{
  "decks": [
    {
      "id": 1,
      "title": "Anatomia Card√≠aca",
      "cardCount": 25,
      "created_at": "2024-01-01T10:00:00Z",
      "updated_at": "2024-01-15T14:30:00Z"
    },
    {
      "id": 2,
      "title": "Farmacologia",
      "cardCount": 30,
      "created_at": "2024-01-10T08:00:00Z",
      "updated_at": "2024-01-20T16:45:00Z"
    }
  ]
}
```

**Errors**:

- `401`: N√£o autenticado
- `500`: Erro interno do servidor

</Card>

<Card title="POST /api/decks">

üîí **Rota Protegida**

Cria um novo baralho com cards.

**Request Body**:

```json
{
  "title": "Farmacologia B√°sica",
  "cards": [
    {
      "front": "O que √© aspirina?",
      "back": "√Åcido acetilsalic√≠lico",
      "mediaType": null,
      "mediaUrl": null
    },
    {
      "front": "Para que serve a aspirina?",
      "back": "Anti-inflamat√≥rio e anticoagulante",
      "mediaType": "image",
      "mediaUrl": "/uploads/images/aspirina.jpg"
    }
  ]
}
```

**Response** (201 Created):

```json
{
  "message": "Baralho criado com sucesso",
  "deck": {
    "id": 3,
    "title": "Farmacologia B√°sica",
    "user_id": 1,
    "created_at": "2024-01-25T10:00:00Z",
    "updated_at": "2024-01-25T10:00:00Z"
  }
}
```

**Errors**:

- `400`: Dados inv√°lidos (t√≠tulo obrigat√≥rio, m√≠nimo 1 card)
- `401`: N√£o autenticado
- `500`: Erro interno do servidor

</Card>

<Card title="GET /api/decks/[id]">

üîí **Rota Protegida**

Obt√©m detalhes de um baralho espec√≠fico incluindo todos os seus cards.

**URL Parameters**:

- `id`: ID do baralho

**Response** (200 OK):

```json
{
  "deck": {
    "id": 1,
    "title": "Anatomia Card√≠aca",
    "user_id": 1,
    "created_at": "2024-01-01T10:00:00Z",
    "updated_at": "2024-01-15T14:30:00Z"
  },
  "cards": [
    {
      "id": 1,
      "deck_id": 1,
      "front": "Quantas c√¢maras tem o cora√ß√£o?",
      "back": "Quatro: dois √°trios e dois ventr√≠culos",
      "media_type": null,
      "media_url": null,
      "created_at": "2024-01-01T10:00:00Z"
    },
    {
      "id": 2,
      "deck_id": 1,
      "front": "Anatomia do cora√ß√£o",
      "back": "Estrutura muscular dividida em quatro c√¢maras",
      "media_type": "image",
      "media_url": "/uploads/images/coracao.jpg",
      "created_at": "2024-01-01T10:05:00Z"
    }
  ]
}
```

**Errors**:

- `401`: N√£o autenticado
- `403`: Baralho n√£o pertence ao usu√°rio
- `404`: Baralho n√£o encontrado
- `500`: Erro interno do servidor

</Card>

<Card title="PUT /api/decks/[id]">

üîí **Rota Protegida**

Atualiza um baralho existente (t√≠tulo e cards).

**URL Parameters**:

- `id`: ID do baralho

**Request Body**:

```json
{
  "title": "Anatomia Card√≠aca Avan√ßada",
  "cards": [
    {
      "front": "Pergunta atualizada",
      "back": "Resposta atualizada",
      "mediaType": "audio",
      "mediaUrl": "/uploads/audio/som.mp3"
    }
  ]
}
```

**Response** (200 OK):

```json
{
  "message": "Baralho atualizado com sucesso",
  "deck": {
    "id": 1,
    "title": "Anatomia Card√≠aca Avan√ßada",
    "user_id": 1,
    "updated_at": "2024-01-26T15:30:00Z"
  }
}
```

**Errors**:

- `400`: Dados inv√°lidos
- `401`: N√£o autenticado
- `403`: Baralho n√£o pertence ao usu√°rio
- `404`: Baralho n√£o encontrado
- `500`: Erro interno do servidor

</Card>

<Card title="DELETE /api/decks/[id]">

üîí **Rota Protegida**

Exclui um baralho e todos os seus cards permanentemente.

**URL Parameters**:

- `id`: ID do baralho

**Response** (200 OK):

```json
{
  "message": "Baralho exclu√≠do com sucesso"
}
```

**Errors**:

- `401`: N√£o autenticado
- `403`: Baralho n√£o pertence ao usu√°rio
- `404`: Baralho n√£o encontrado
- `500`: Erro interno do servidor

</Card>

---

### Progresso

<Card title="GET /api/decks/[id]/progress">

üîí **Rota Protegida**

Obt√©m o progresso de estudo do usu√°rio em um baralho espec√≠fico.

**URL Parameters**:

- `id`: ID do baralho

**Response** (200 OK):

```json
{
  "progress": [
    {
      "card_id": 1,
      "ease_factor": 2.5,
      "interval": 1,
      "repetitions": 0,
      "next_review": "2024-01-27T10:00:00Z",
      "last_reviewed": null
    },
    {
      "card_id": 2,
      "ease_factor": 2.6,
      "interval": 6,
      "repetitions": 2,
      "next_review": "2024-02-01T10:00:00Z",
      "last_reviewed": "2024-01-26T14:30:00Z"
    }
  ]
}
```

**Errors**:
- `401`: N√£o autenticado
- `403`: Baralho n√£o pertence ao usu√°rio
- `404`: Baralho n√£o encontrado
- `500`: Erro interno do servidor

</Card>

<Card title="POST /api/decks/[id]/progress">

üîí **Rota Protegida**

Atualiza o progresso ap√≥s revisar um card.

**URL Parameters**:

- `id`: ID do baralho

**Request Body**:

```json
{
  "cardId": 1,
  "quality": 4
}
```

**Quality Scale**:

- `0`: Resposta completamente errada
- `1`: Resposta errada mas familiar
- `2`: Resposta errada mas f√°cil de lembrar
- `3`: Resposta correta com dificuldade
- `4`: Resposta correta com hesita√ß√£o
- `5`: Resposta perfeita

**Response** (200 OK):

```json
{
  "message": "Progresso atualizado",
  "progress": {
    "card_id": 1,
    "ease_factor": 2.6,
    "interval": 6,
    "repetitions": 1,
    "next_review": "2024-02-02T10:00:00Z",
    "last_reviewed": "2024-01-27T10:00:00Z"
  }
}
```

**Errors**:

- `400`: Dados inv√°lidos
- `401`: N√£o autenticado
- `403`: Card n√£o pertence ao usu√°rio
- `404`: Card n√£o encontrado
- `500`: Erro interno do servidor

</Card>

---

### Upload

<Card title="POST /api/upload">

üîí **Rota Protegida**

Faz upload de arquivo (imagem ou √°udio).

**Content-Type**: `multipart/form-data`

**Form Data**:

- `file`: Arquivo a ser enviado
- `type`: "image" ou "audio"

**Image Formats**: JPG, JPEG, PNG, GIF, WebP (m√°x 5MB)
**Audio Formats**: MP3, WAV, OGG, M4A (m√°x 10MB)

**Response** (200 OK):

```json
{
  "url": "/uploads/images/1234567890-foto.jpg"
}
```

**Errors**:
- `400`: Arquivo n√£o enviado ou tipo inv√°lido
- `401`: N√£o autenticado
- `413`: Arquivo muito grande
- `415`: Formato n√£o suportado
- `500`: Erro ao salvar arquivo

</Card>

---

### Perfil

<Card title="GET /api/profile">

üîí **Rota Protegida**

Obt√©m informa√ß√µes do perfil do usu√°rio autenticado.

**Response** (200 OK):

```json
{
  "user": {
    "id": 1,
    "name": "Jo√£o Silva",
    "email": "joao@example.com",
    "created_at": "2024-01-01T10:00:00Z"
  },
  "stats": {
    "totalDecks": 5,
    "totalCards": 120,
    "totalReviews": 450,
    "averageAccuracy": 0.85
  }
}
```

**Errors**:
- `401`: N√£o autenticado
- `500`: Erro interno do servidor

</Card>

---

## üîí Seguran√ßa

### Autentica√ß√£o JWT

<Callout type="info" title="JSON Web Token">
  O sistema usa JWT (JSON Web Token) para autentica√ß√£o stateless.
</Callout>

**Token Storage**: Cookie HTTP-only chamado `token`
**Token Duration**: 24 horas
**Token Refresh**: N√£o implementado (requer novo login)

### Headers Necess√°rios

Para rotas protegidas, o cookie `token` deve estar presente:

```http
Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Rate Limiting

<Callout type="warning">
  Atualmente n√£o h√° rate limiting implementado. Planejado para v1.2.
</Callout>

---

## üìä C√≥digos de Status

<Card title="Status HTTP">
  - `200 OK`: Requisi√ß√£o bem-sucedida - `201 Created`: Recurso criado com
  sucesso - `400 Bad Request`: Dados inv√°lidos ou ausentes - `401 Unauthorized`:
  N√£o autenticado - `403 Forbidden`: Sem permiss√£o para acessar recurso - `404
  Not Found`: Recurso n√£o encontrado - `409 Conflict`: Conflito (ex: email j√°
  cadastrado) - `413 Payload Too Large`: Arquivo muito grande - `415 Unsupported
  Media Type`: Formato n√£o suportado - `500 Internal Server Error`: Erro no
  servidor
</Card>

---

## üß™ Exemplos de Uso

### cURL

<CodeBlock title="Criar conta" language="bash">
  {`curl -X POST http://localhost:3000/api/auth/signup \\
  -H "Content-Type: application/json" \\
  -d '{
    "name": "Jo√£o Silva",
    "email": "joao@example.com",
    "password": "senha123"
  }'`}
</CodeBlock>

<CodeBlock title="Fazer login" language="bash">
  {`curl -X POST http://localhost:3000/api/auth/login \\
  -H "Content-Type: application/json" \\
  -d '{
    "email": "joao@example.com",
    "password": "senha123"
  }' \\
  -c cookies.txt`}
</CodeBlock>

<CodeBlock title="Listar baralhos" language="bash">
  {`curl -X GET http://localhost:3000/api/decks \\
  -b cookies.txt`}
</CodeBlock>

### JavaScript (fetch)

<CodeBlock title="Criar baralho" language="javascript">
{`const response = await fetch('/api/decks', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  credentials: 'include', // Inclui cookies
  body: JSON.stringify({
    title: 'Farmacologia',
    cards: [
      {
        front: 'O que √© aspirina?',
        back: '√Åcido acetilsalic√≠lico',
        mediaType: null,
        mediaUrl: null
      }
    ]
  })
});

const data = await response.json();
console.log(data);`}

</CodeBlock>

### TypeScript

<CodeBlock title="Interface de tipos" language="typescript">
{`interface User {
  id: number;
  name: string;
  email: string;
  created_at: string;
}

interface Card {
id?: number;
deck_id?: number;
front: string;
back: string;
media_type: 'image' | 'audio' | null;
media_url: string | null;
created_at?: string;
}

interface Deck {
id?: number;
title: string;
user_id?: number;
created_at?: string;
updated_at?: string;
cards?: Card[];
cardCount?: number;
}

interface Progress {
card_id: number;
ease_factor: number;
interval: number;
repetitions: number;
next_review: string;
last_reviewed: string | null;
}`}

</CodeBlock>

---

## üîÑ Webhooks

<Callout type="warning">
  Webhooks n√£o est√£o implementados na vers√£o atual. Planejado para v2.0.
</Callout>

---

## üìù Changelog da API

### v1.0.0 (Atual)

- ‚úÖ Autentica√ß√£o (signup, login, logout)
- ‚úÖ CRUD de baralhos
- ‚úÖ Upload de arquivos
- ‚úÖ Dashboard
- ‚úÖ Perfil de usu√°rio
- ‚úÖ Sistema de progresso b√°sico

### v1.1 (Planejado)

- [ ] Recupera√ß√£o de senha
- [ ] Edi√ß√£o de perfil
- [ ] Rate limiting
- [ ] Pagina√ß√£o em listagens
- [ ] Filtros e busca

### v2.0 (Futuro)

- [ ] Webhooks
- [ ] API p√∫blica com chaves
- [ ] GraphQL endpoint
- [ ] WebSocket para tempo real
- [ ] Versionamento da API

---

<Callout type="success" title="Documenta√ß√£o Completa">
  Para mais detalhes t√©cnicos, consulte a [Arquitetura do
  Sistema](/docs/arquitetura).
</Callout>
