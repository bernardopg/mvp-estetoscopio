export const metadata = {
  title: "Arquitetura",
  description: "DocumentaÃ§Ã£o tÃ©cnica do MVP EstetoscÃ³pio",
};

# ğŸ—ï¸ Arquitetura do Sistema

<Callout type="info" title="DocumentaÃ§Ã£o TÃ©cnica">
  Esta pÃ¡gina descreve a arquitetura, tecnologias e estrutura do MVP
  EstetoscÃ³pio.
</Callout>

---

## ğŸ“Š VisÃ£o Geral

O MVP EstetoscÃ³pio Ã© uma aplicaÃ§Ã£o web full-stack construÃ­da com Next.js 16, utilizando o App Router para mÃ¡xima performance e SEO.

<Card title="Principais CaracterÃ­sticas">
  - **SSR/SSG**: RenderizaÃ§Ã£o no servidor para performance otimizada - **API
  Routes**: Backend integrado no Next.js - **TypeScript**: Tipagem estÃ¡tica para
  maior seguranÃ§a - **Tailwind CSS**: EstilizaÃ§Ã£o utilitÃ¡ria e responsiva -
  **SQLite**: Banco de dados leve e eficiente
</Card>

---

## ğŸ› ï¸ Stack TecnolÃ³gica

### Frontend

<FeatureGrid>
<Card title="Next.js 16">
Framework React com App Router, Server Components e otimizaÃ§Ãµes automÃ¡ticas.
</Card>

<Card title="TypeScript 5">
  Linguagem com tipagem estÃ¡tica para cÃ³digo mais robusto e manutenÃ­vel.
</Card>

<Card title="Tailwind CSS 4">
  Framework CSS utilitÃ¡rio para estilizaÃ§Ã£o rÃ¡pida e consistente.
</Card>

<Card title="Lucide React">
  Biblioteca de Ã­cones moderna e otimizada com mais de 1000 Ã­cones.
</Card>

<Card title="MDX">
  Markdown com componentes React para documentaÃ§Ã£o interativa.
</Card>

<Card title="Marked">
Parser de Markdown para renderizaÃ§Ã£o de conteÃºdo nos flashcards.
</Card>
</FeatureGrid>

### Backend

<FeatureGrid>
<Card title="Next.js API Routes">
Endpoints RESTful integrados no framework Next.js.
</Card>

<Card title="SQLite">
  Banco de dados relacional leve, perfeito para MVPs e aplicaÃ§Ãµes
  pequenas/mÃ©dias.
</Card>

<Card title="better-sqlite3">
  Driver Node.js sÃ­ncrono para SQLite com melhor performance.
</Card>

<Card title="JWT">JSON Web Tokens para autenticaÃ§Ã£o stateless e segura.</Card>

<Card title="bcryptjs">
  Hashing de senhas com algoritmo bcrypt para seguranÃ§a.
</Card>

<Card title="cookie">
Gerenciamento de cookies HTTP-only para armazenar tokens de forma segura.
</Card>
</FeatureGrid>

---

## ğŸ“ Estrutura do Projeto

<CodeBlock title="Estrutura de DiretÃ³rios" language="text">
  {`mvp-estetoscopio/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # App Router (Next.js 16)
â”‚   â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # AutenticaÃ§Ã£o (login, signup, logout)
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/     # Dados do dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ decks/         # CRUD de baralhos
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/       # Perfil do usuÃ¡rio
â”‚   â”‚   â”‚   â””â”€â”€ upload/        # Upload de arquivos
â”‚   â”‚   â”œâ”€â”€ baralhos/          # PÃ¡ginas de baralhos
â”‚   â”‚   â”œâ”€â”€ docs/              # DocumentaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ flashcards/        # Modo de estudo
â”‚   â”‚   â”œâ”€â”€ login/             # Login
â”‚   â”‚   â”œâ”€â”€ perfil/            # Perfil
â”‚   â”‚   â”œâ”€â”€ signup/            # Cadastro
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # Layout principal
â”‚   â”‚   â”œâ”€â”€ page.tsx           # PÃ¡gina inicial
â”‚   â”‚   â””â”€â”€ globals.css        # Estilos globais
â”‚   â”œâ”€â”€ components/            # Componentes React
â”‚   â”‚   â”œâ”€â”€ AudioPlayer.tsx
â”‚   â”‚   â”œâ”€â”€ Flashcard.tsx
â”‚   â”‚   â”œâ”€â”€ MarkdownRenderer.tsx
â”‚   â”‚   â”œâ”€â”€ MediaFlashcard.tsx
â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”œâ”€â”€ lib/                   # UtilitÃ¡rios e lÃ³gica de negÃ³cio
â”‚   â”‚   â”œâ”€â”€ auth.ts           # FunÃ§Ãµes de autenticaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ db.ts             # ConexÃ£o com SQLite
â”‚   â”‚   â””â”€â”€ spaced-repetition.ts
â”‚   â”œâ”€â”€ types/                 # DefiniÃ§Ãµes de tipos TypeScript
â”‚   â”‚   â””â”€â”€ globals.d.ts
â”‚   â””â”€â”€ middleware.ts          # Middleware de autenticaÃ§Ã£o
â”œâ”€â”€ docs/                      # DocumentaÃ§Ã£o MDX
â”‚   â”œâ”€â”€ components/            # Componentes para docs
â”‚   â”œâ”€â”€ index.mdx
â”‚   â”œâ”€â”€ guia.mdx
â”‚   â”œâ”€â”€ faq.mdx
â”‚   â””â”€â”€ arquitetura.mdx
â”œâ”€â”€ public/                    # Arquivos estÃ¡ticos
â”‚   â””â”€â”€ uploads/               # Uploads de usuÃ¡rios
â”‚       â”œâ”€â”€ images/
â”‚       â””â”€â”€ audio/
â”œâ”€â”€ mvp-estetoscopio.db       # Banco de dados SQLite
â”œâ”€â”€ next.config.ts            # ConfiguraÃ§Ã£o Next.js
â”œâ”€â”€ tailwind.config.ts        # ConfiguraÃ§Ã£o Tailwind
â”œâ”€â”€ tsconfig.json             # ConfiguraÃ§Ã£o TypeScript
â””â”€â”€ package.json              # DependÃªncias`}
</CodeBlock>

---

## ğŸ—„ï¸ Banco de Dados

### Modelo de Dados

<Card title="Tabela: users">
Armazena informaÃ§Ãµes dos usuÃ¡rios do sistema.

```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

</Card>

<Card title="Tabela: decks">
Armazena os baralhos de flashcards.

```sql
CREATE TABLE decks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  user_id INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

</Card>

<Card title="Tabela: cards">
Armazena os flashcards individuais.

```sql
CREATE TABLE cards (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  deck_id INTEGER NOT NULL,
  front TEXT NOT NULL,
  back TEXT NOT NULL,
  media_type TEXT,
  media_url TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (deck_id) REFERENCES decks(id)
);
```

</Card>

<Card title="Tabela: progress">
Rastreia o progresso do usuÃ¡rio em cada card.

```sql
CREATE TABLE progress (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  card_id INTEGER NOT NULL,
  ease_factor REAL DEFAULT 2.5,
  interval INTEGER DEFAULT 0,
  repetitions INTEGER DEFAULT 0,
  next_review DATE,
  last_reviewed DATE,
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (card_id) REFERENCES cards(id)
);
```

</Card>

---

## ğŸ” AutenticaÃ§Ã£o e SeguranÃ§a

### Fluxo de AutenticaÃ§Ã£o

<Step number={1} title="Cadastro">
  1. UsuÃ¡rio envia nome, email e senha 2. Sistema valida dados 3. Senha Ã©
  hasheada com bcrypt (10 rounds) 4. Dados sÃ£o salvos no banco 5. JWT Ã© gerado e
  enviado em cookie HTTP-only
</Step>

<Step number={2} title="Login">
  1. UsuÃ¡rio envia email e senha 2. Sistema busca usuÃ¡rio no banco 3. Senha Ã©
  comparada com hash armazenado 4. Se vÃ¡lido, JWT Ã© gerado 5. Token enviado em
  cookie HTTP-only com duraÃ§Ã£o de 24h
</Step>

<Step number={3} title="Rotas Protegidas">
  1. Middleware intercepta requisiÃ§Ãµes 2. Verifica presenÃ§a do token no cookie
  3. Valida assinatura e expiraÃ§Ã£o do JWT 4. Adiciona dados do usuÃ¡rio ao
  request 5. Permite ou nega acesso
</Step>

### SeguranÃ§a Implementada

<Card title="Medidas de SeguranÃ§a">
  âœ… **Senhas hasheadas**: bcrypt com salt de 10 rounds âœ… **JWT**: Tokens
  assinados com chave secreta âœ… **HTTP-only cookies**: Protege contra XSS âœ…
  **ValidaÃ§Ã£o de entrada**: SanitizaÃ§Ã£o de dados âœ… **Prepared statements**:
  ProteÃ§Ã£o contra SQL injection âœ… **HTTPS**: Recomendado em produÃ§Ã£o
</Card>

---

## ğŸ”„ Algoritmo de RepetiÃ§Ã£o EspaÃ§ada

### ImplementaÃ§Ã£o SM-2

<Callout type="info" title="SuperMemo 2">
  O sistema usa uma variaÃ§Ã£o do algoritmo SM-2 para calcular intervalos de
  revisÃ£o.
</Callout>

<Card title="FÃ³rmula BÃ¡sica">
```typescript
function calculateNextReview(quality: number, repetitions: number, easeFactor: number, interval: number) {
  let newEaseFactor = easeFactor;
  let newInterval = interval;
  let newRepetitions = repetitions;

if (quality < 3) {
// Resposta incorreta - reinicia
newRepetitions = 0;
newInterval = 1;
} else {
// Resposta correta
newRepetitions++;

    if (newRepetitions === 1) {
      newInterval = 1;
    } else if (newRepetitions === 2) {
      newInterval = 6;
    } else {
      newInterval = Math.round(interval * newEaseFactor);
    }

}

// Ajusta fator de facilidade
newEaseFactor = newEaseFactor + (0.1 - (5 - quality) _ (0.08 + (5 - quality) _ 0.02));

if (newEaseFactor < 1.3) newEaseFactor = 1.3;

return {
easeFactor: newEaseFactor,
interval: newInterval,
repetitions: newRepetitions,
nextReview: new Date(Date.now() + newInterval _ 24 _ 60 _ 60 _ 1000)
};
}

````
</Card>

### ParÃ¢metros

<FeatureGrid>
<Card title="Quality (Qualidade)">
1-5 baseado na resposta do usuÃ¡rio:
- 1: Muito difÃ­cil
- 2: DifÃ­cil
- 3: Bom
- 4: FÃ¡cil
- 5: Muito fÃ¡cil
</Card>

<Card title="Ease Factor">
Fator de facilidade inicial: **2.5**

Ajustado apÃ³s cada revisÃ£o baseado no desempenho.
</Card>

<Card title="Interval (Intervalo)">
Dias atÃ© prÃ³xima revisÃ£o:
- Nova: 1 dia
- Segunda: 6 dias
- Subsequentes: `intervalo Ã— easeFactor`
</Card>
</FeatureGrid>

---

## ğŸ“¡ API Routes

### AutenticaÃ§Ã£o

<Card title="POST /api/auth/signup">
Cria uma nova conta de usuÃ¡rio.

**Body**:
```json
{
  "name": "JoÃ£o Silva",
  "email": "joao@example.com",
  "password": "senha123"
}
````

**Resposta** (201):

```json
{
  "message": "UsuÃ¡rio criado com sucesso",
  "user": {
    "id": 1,
    "name": "JoÃ£o Silva",
    "email": "joao@example.com"
  }
}
```

</Card>

<Card title="POST /api/auth/login">
Realiza login e retorna token JWT.

**Body**:

```json
{
  "email": "joao@example.com",
  "password": "senha123"
}
```

**Resposta** (200):

```json
{
  "message": "Login bem-sucedido",
  "user": {
    "id": 1,
    "name": "JoÃ£o Silva",
    "email": "joao@example.com"
  }
}
```

</Card>

<Card title="POST /api/auth/logout">
Realiza logout e remove o token.

**Resposta** (200):

```json
{
  "message": "Logout realizado"
}
```

</Card>

### Baralhos

<Card title="GET /api/decks">
Lista todos os baralhos do usuÃ¡rio autenticado.

**Resposta** (200):

```json
{
  "decks": [
    {
      "id": 1,
      "title": "Anatomia CardÃ­aca",
      "cardCount": 25,
      "created_at": "2024-01-01T10:00:00Z",
      "updated_at": "2024-01-15T14:30:00Z"
    }
  ]
}
```

</Card>

<Card title="POST /api/decks">
Cria um novo baralho.

**Body**:

```json
{
  "title": "Farmacologia",
  "cards": [
    {
      "front": "O que Ã© aspirina?",
      "back": "Ãcido acetilsalicÃ­lico",
      "mediaType": null,
      "mediaUrl": null
    }
  ]
}
```

</Card>

<Card title="GET /api/decks/[id]">
  ObtÃ©m detalhes de um baralho especÃ­fico incluindo seus cards.
</Card>

<Card title="PUT /api/decks/[id]">Atualiza um baralho existente.</Card>

<Card title="DELETE /api/decks/[id]">
  Exclui um baralho e todos os seus cards.
</Card>

### Upload

<Card title="POST /api/upload">
Faz upload de arquivos (imagens ou Ã¡udio).

**Content-Type**: `multipart/form-data`

**Body**:

- `file`: Arquivo a ser enviado
- `type`: "image" ou "audio"

**Resposta** (200):

```json
{
  "url": "/uploads/images/1234567890-foto.jpg"
}
```

</Card>

---

## ğŸ¨ Componentes Principais

### AudioPlayer

<Card>
Reprodutor de Ã¡udio customizado para flashcards com Ã¡udio.

**Props**:

- `src`: URL do arquivo de Ã¡udio
- `className?`: Classes CSS adicionais

**Recursos**:

- Play/Pause
- Controle de volume
- Barra de progresso
- DuraÃ§Ã£o total

</Card>

### Flashcard

<Card>
Componente de flashcard com animaÃ§Ã£o de virada.

**Props**:

- `front`: ConteÃºdo da frente
- `back`: ConteÃºdo do verso
- `isFlipped`: Estado de virado
- `onClick`: Callback ao clicar

**Recursos**:

- AnimaÃ§Ã£o 3D de flip
- Suporte a Markdown
- Responsivo

</Card>

### MediaFlashcard

<Card>
Flashcard especializado para conteÃºdo multimÃ­dia.

**Props**:

- `front`: Texto da frente
- `back`: Texto do verso
- `mediaType`: "image" ou "audio"
- `mediaUrl`: URL do arquivo
- `isFlipped`: Estado

**Recursos**:

- Renderiza imagem ou player de Ã¡udio
- Lazy loading de imagens
- Suporte a Markdown

</Card>

### MarkdownRenderer

<Card>
Renderizador de Markdown com suporte a LaTeX e cÃ³digo.

**Props**:

- `content`: HTML gerado pelo `marked`
- `title`: TÃ­tulo opcional

**Recursos**:

- Syntax highlighting
- Suporte a LaTeX (via KaTeX)
- Tabelas
- Listas
- Code blocks

</Card>

---

## ğŸš€ Deploy e Performance

### OtimizaÃ§Ãµes

<FeatureGrid>
<Card title="Server Components">
Componentes renderizados no servidor por padrÃ£o, reduzindo o JavaScript enviado ao cliente.
</Card>

<Card title="Image Optimization">
  OtimizaÃ§Ã£o automÃ¡tica de imagens pelo Next.js com lazy loading e formatos
  modernos (WebP).
</Card>

<Card title="Code Splitting">
  DivisÃ£o automÃ¡tica de cÃ³digo para carregar apenas o necessÃ¡rio em cada pÃ¡gina.
</Card>

<Card title="Static Generation">
  PÃ¡ginas estÃ¡ticas sÃ£o prÃ©-renderizadas em build time para mÃ¡xima performance.
</Card>

<Card title="API Routes Cache">
  Cache de respostas de API quando apropriado para reduzir carga no banco.
</Card>

<Card title="Tailwind CSS">
CSS minificado e tree-shaken, removendo estilos nÃ£o utilizados.
</Card>
</FeatureGrid>

### Deploy Recomendado

<Card title="Vercel">
Plataforma nativa do Next.js com deploy automÃ¡tico via Git.

**Vantagens**:

- Zero configuraÃ§Ã£o
- Deploy automÃ¡tico em cada push
- Preview URLs para PRs
- Edge Functions
- Analytics integrado

</Card>

<Callout type="warning" title="Nota sobre SQLite">
  SQLite funciona bem para MVPs, mas considere migrar para PostgreSQL ou MySQL
  em produÃ§Ã£o com muitos usuÃ¡rios concorrentes.
</Callout>

---

## ğŸ”® Roadmap TÃ©cnico

### v1.1 (PrÃ³xima)

- [ ] Sistema de recuperaÃ§Ã£o de senha
- [ ] EdiÃ§Ã£o de perfil
- [ ] ReordenaÃ§Ã£o de cards (drag-and-drop)
- [ ] DuplicaÃ§Ã£o de baralhos
- [ ] Suporte a URLs de imagens externas

### v1.2

- [ ] PWA (Progressive Web App)
- [ ] Modo offline
- [ ] NotificaÃ§Ãµes push
- [ ] Temas personalizÃ¡veis
- [ ] Limpeza de arquivos Ã³rfÃ£os

### v2.0

- [ ] ImportaÃ§Ã£o/ExportaÃ§Ã£o de baralhos
- [ ] Compatibilidade com formato Anki
- [ ] Suporte a PostgreSQL/MySQL
- [ ] API pÃºblica documentada
- [ ] Sistema de tags
- [ ] Baralhos compartilhÃ¡veis
- [ ] Comunidade e marketplace

---

<Callout type="success" title="Contribua!">
  O projeto Ã© open source. ContribuiÃ§Ãµes sÃ£o bem-vindas no
  [GitHub](https://github.com/bernardopg/mvp-estetoscopio).
</Callout>
